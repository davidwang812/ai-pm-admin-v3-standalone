<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®æŒä¹…åŒ–æµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #e8e8e8; border-radius: 6px; }
        .test-case h3 { margin-top: 0; color: #1890ff; }
        .success { background: #f6ffed; border-color: #b7eb8f; }
        .warning { background: #fffbe6; border-color: #ffe58f; }
        .error { background: #fff2f0; border-color: #ffccc7; }
        .button { background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #40a9ff; }
        .button.test { background: #52c41a; }
        .button.test:hover { background: #73d13d; }
        .test-steps { background: #fafafa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .test-steps ol { margin: 0; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª é…ç½®æŒä¹…åŒ–æµ‹è¯•</h1>
        <p><strong>é—®é¢˜ï¼š</strong>ä¿å­˜è®¾ç½®åˆ·æ–°ä¹‹åè®¾ç½®å°±ä¸è§äº†</p>
        
        <div class="test-case">
            <h3>ğŸ¯ æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯ç»Ÿä¸€é…ç½®é¡µé¢çš„è®¾ç½®åœ¨ä¿å­˜åèƒ½å¤Ÿæ­£ç¡®æŒä¹…åŒ–ï¼Œåˆ·æ–°é¡µé¢åä¸ä¼šä¸¢å¤±ã€‚</p>
        </div>

        <div class="test-case">
            <h3>ğŸ”§ å·²å®æ–½çš„ä¿®å¤</h3>
            <ul>
                <li>âœ… ä¿®å¤äº†APIé…ç½®è¦†ç›–æœ¬åœ°æ–°æ•°æ®çš„é—®é¢˜</li>
                <li>âœ… æ·»åŠ äº†localStorageä¿å­˜éªŒè¯æœºåˆ¶</li>
                <li>âœ… æ”¹è¿›äº†æ—¶é—´æˆ³å¤„ç†ä»¥è¿›è¡Œæ­£ç¡®çš„ç‰ˆæœ¬æ§åˆ¶</li>
                <li>âœ… æ·»åŠ äº†å¼ºåˆ¶ä»localStorageé‡æ–°åŠ è½½çš„åŠŸèƒ½</li>
                <li>âœ… ç¡®ä¿é…ç½®åœ¨ä¿å­˜å’ŒåŠ è½½æ—¶çš„æ•°æ®å®Œæ•´æ€§</li>
            </ul>
        </div>

        <div class="test-case">
            <h3>ğŸ“‹ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤</h3>
            <div class="test-steps">
                <h4>æ­¥éª¤ 1: åŸºç¡€é…ç½®ä¿å­˜æµ‹è¯•</h4>
                <ol>
                    <li>è®¿é—® <a href="https://ai-pm-admin-v3-prod.vercel.app" target="_blank">https://ai-pm-admin-v3-prod.vercel.app</a></li>
                    <li>ç™»å½•ç®¡ç†å‘˜è´¦æˆ·</li>
                    <li>è¿›å…¥ AIæœåŠ¡ç®¡ç† â†’ ç»Ÿä¸€é…ç½®</li>
                    <li>ä¿®æ”¹å…¨å±€å‚æ•°ï¼ˆå¦‚æ¸©åº¦ä»0.7æ”¹ä¸º0.8ï¼‰</li>
                    <li>ç‚¹å‡»"ğŸ’¾ ä¿å­˜é…ç½®"æŒ‰é’®</li>
                    <li>ç­‰å¾…æˆåŠŸæç¤ºä¿¡æ¯</li>
                    <li><strong>åˆ·æ–°é¡µé¢</strong>ï¼ˆF5æˆ–Ctrl+Rï¼‰</li>
                    <li>æ£€æŸ¥è®¾ç½®æ˜¯å¦ä¿æŒä¸º0.8</li>
                </ol>
            </div>

            <div class="test-steps">
                <h4>æ­¥éª¤ 2: AIæœåŠ¡åˆ†é…æµ‹è¯•</h4>
                <ol>
                    <li>åœ¨ç»Ÿä¸€é…ç½®é¡µé¢çš„è¡¨æ ¼ä¸­</li>
                    <li>é€‰æ‹©ä¸€ä¸ªAIæœåŠ¡ï¼ˆå¦‚æé—®AIï¼‰åˆ†é…ç»™æŸä¸ªæœåŠ¡å•†</li>
                    <li>ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ä¿®æ”¹æç¤ºè¯</li>
                    <li>ä¿å­˜æç¤ºè¯æ›´æ”¹</li>
                    <li>ç‚¹å‡»"ğŸ’¾ ä¿å­˜é…ç½®"æŒ‰é’®</li>
                    <li><strong>åˆ·æ–°é¡µé¢</strong></li>
                    <li>æ£€æŸ¥æœåŠ¡åˆ†é…å’Œæç¤ºè¯æ˜¯å¦ä¿æŒä¸å˜</li>
                </ol>
            </div>

            <div class="test-steps">
                <h4>æ­¥éª¤ 3: æ•…éšœæ’é™¤æµ‹è¯•</h4>
                <ol>
                    <li>å¦‚æœé…ç½®ä¸¢å¤±ï¼Œç‚¹å‡»"ğŸ’¾ ä»æœ¬åœ°åŠ è½½"æŒ‰é’®</li>
                    <li>æŸ¥çœ‹æ˜¯å¦æ¢å¤äº†ä¹‹å‰çš„è®¾ç½®</li>
                    <li>å¦‚æœä»æœ‰é—®é¢˜ï¼Œä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
                    <li>æŸ¥çœ‹Consoleè¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯</li>
                    <li>æ£€æŸ¥localStorageä¸­çš„unified_configå†…å®¹</li>
                </ol>
            </div>
        </div>

        <div class="test-case">
            <h3>ğŸ” è°ƒè¯•å·¥å…·</h3>
            <button class="button" onclick="openDebugTool()">ğŸ› ï¸ æ‰“å¼€è°ƒè¯•å·¥å…·</button>
            <button class="button" onclick="checkLocalStorage()">ğŸ“Š æ£€æŸ¥LocalStorage</button>
            <button class="button test" onclick="runQuickTest()">âš¡ å¿«é€Ÿæµ‹è¯•</button>
            
            <div id="debug-result" style="margin-top: 15px;"></div>
        </div>

        <div class="test-case">
            <h3>âš ï¸ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3>
            
            <div class="test-steps">
                <h4>é—®é¢˜ 1: è®¾ç½®ä¿å­˜ååˆ·æ–°æ¶ˆå¤±</h4>
                <p><strong>åŸå› ï¼š</strong>APIè¿”å›çš„æ—§æ•°æ®è¦†ç›–äº†æœ¬åœ°æ–°æ•°æ®</p>
                <p><strong>è§£å†³ï¼š</strong>ç°å·²ä¿®å¤æ—¶é—´æˆ³æ¯”è¾ƒé€»è¾‘ï¼Œç¡®ä¿æœ¬åœ°æ–°æ•°æ®ä¼˜å…ˆ</p>
            </div>

            <div class="test-steps">
                <h4>é—®é¢˜ 2: localStorageä¿å­˜å¤±è´¥</h4>
                <p><strong>åŸå› ï¼š</strong>æµè§ˆå™¨å­˜å‚¨é™åˆ¶æˆ–æ•°æ®æ ¼å¼é”™è¯¯</p>
                <p><strong>è§£å†³ï¼š</strong>æ·»åŠ äº†ä¿å­˜éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶</p>
            </div>

            <div class="test-steps">
                <h4>é—®é¢˜ 3: é…ç½®ç»“æ„ä¸æ­£ç¡®</h4>
                <p><strong>åŸå› ï¼š</strong>æ—§ç‰ˆæœ¬é…ç½®æ ¼å¼ä¸æ–°ç‰ˆæœ¬ä¸å…¼å®¹</p>
                <p><strong>è§£å†³ï¼š</strong>ç‚¹å‡»"ä»æœ¬åœ°åŠ è½½"æˆ–"é‡ç½®é…ç½®"æŒ‰é’®</p>
            </div>
        </div>

        <div class="test-case">
            <h3>âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•</h3>
            <div style="display: grid; gap: 10px; margin: 15px 0;">
                <label><input type="checkbox" id="test1"> å…¨å±€å‚æ•°è®¾ç½®èƒ½å¤Ÿä¿å­˜å¹¶åœ¨åˆ·æ–°åä¿æŒ</label>
                <label><input type="checkbox" id="test2"> AIæœåŠ¡åˆ†é…èƒ½å¤Ÿä¿å­˜å¹¶åœ¨åˆ·æ–°åä¿æŒ</label>
                <label><input type="checkbox" id="test3"> è‡ªå®šä¹‰æç¤ºè¯èƒ½å¤Ÿä¿å­˜å¹¶åœ¨åˆ·æ–°åä¿æŒ</label>
                <label><input type="checkbox" id="test4"> "ä»æœ¬åœ°åŠ è½½"æŒ‰é’®èƒ½å¤Ÿæ¢å¤é…ç½®</label>
                <label><input type="checkbox" id="test5"> ä¿å­˜æ—¶æ˜¾ç¤ºæ­£ç¡®çš„æˆåŠŸ/å¤±è´¥æç¤º</label>
                <label><input type="checkbox" id="test6"> æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ç›¸å…³é”™è¯¯ä¿¡æ¯</label>
            </div>
            
            <button class="button test" onclick="checkAllTests()">âœ… æ£€æŸ¥æµ‹è¯•å®Œæˆæƒ…å†µ</button>
            <div id="test-summary"></div>
        </div>
    </div>

    <script>
        function openDebugTool() {
            window.open('./debug-config-persistence.html', '_blank');
        }

        function checkLocalStorage() {
            const result = document.getElementById('debug-result');
            const config = localStorage.getItem('unified_config');
            
            if (config) {
                try {
                    const parsed = JSON.parse(config);
                    const lastUpdated = parsed.lastUpdated ? new Date(parsed.lastUpdated).toLocaleString() : 'æ— ';
                    
                    result.innerHTML = `
                        <div class="result success">
                            <h4>âœ… LocalStorage æ£€æŸ¥ç»“æœ</h4>
                            <p><strong>é…ç½®å­˜åœ¨ï¼š</strong>æ˜¯</p>
                            <p><strong>æ•°æ®å¤§å°ï¼š</strong>${new Blob([config]).size} bytes</p>
                            <p><strong>æœ€åæ›´æ–°ï¼š</strong>${lastUpdated}</p>
                            <p><strong>å…¨å±€å‚æ•°ï¼š</strong>${parsed.globalParams ? 'å­˜åœ¨' : 'ç¼ºå¤±'}</p>
                            <p><strong>AIæœåŠ¡ï¼š</strong>${parsed.aiServices ? 'å­˜åœ¨' : 'ç¼ºå¤±'}</p>
                        </div>
                    `;
                } catch (e) {
                    result.innerHTML = `
                        <div class="result error">
                            <h4>âŒ LocalStorage æ£€æŸ¥ç»“æœ</h4>
                            <p><strong>é…ç½®å­˜åœ¨ï¼š</strong>æ˜¯</p>
                            <p><strong>è§£æçŠ¶æ€ï¼š</strong>å¤±è´¥ - ${e.message}</p>
                        </div>
                    `;
                }
            } else {
                result.innerHTML = `
                    <div class="result warning">
                        <h4>âš ï¸ LocalStorage æ£€æŸ¥ç»“æœ</h4>
                        <p><strong>é…ç½®å­˜åœ¨ï¼š</strong>å¦</p>
                        <p><strong>å»ºè®®ï¼š</strong>å…ˆåœ¨ç»Ÿä¸€é…ç½®é¡µé¢ä¿å­˜ä¸€æ¬¡è®¾ç½®</p>
                    </div>
                `;
            }
        }

        function runQuickTest() {
            const result = document.getElementById('debug-result');
            result.innerHTML = `
                <div class="result">
                    <h4>âš¡ å¿«é€Ÿæµ‹è¯•æ‰§è¡Œä¸­...</h4>
                    <p>æ­£åœ¨æ£€æŸ¥é…ç½®ä¿å­˜å’ŒåŠ è½½åŠŸèƒ½...</p>
                </div>
            `;

            // æ¨¡æ‹Ÿé…ç½®æµ‹è¯•
            setTimeout(() => {
                const testConfig = {
                    globalParams: {
                        temperature: 0.85,
                        topP: 0.9,
                        maxTokens: 2000
                    },
                    aiServices: {
                        questionAI: {
                            enabled: true,
                            provider: 'openai',
                            prompt: 'æµ‹è¯•æç¤ºè¯ - ' + new Date().getTime(),
                            temperature: 0.85
                        }
                    },
                    lastUpdated: new Date().toISOString(),
                    testMode: true
                };

                // ä¿å­˜æµ‹è¯•é…ç½®
                localStorage.setItem('unified_config', JSON.stringify(testConfig));
                
                // éªŒè¯ä¿å­˜
                const saved = localStorage.getItem('unified_config');
                const success = saved && JSON.parse(saved).testMode;

                result.innerHTML = `
                    <div class="result ${success ? 'success' : 'error'}">
                        <h4>${success ? 'âœ…' : 'âŒ'} å¿«é€Ÿæµ‹è¯•ç»“æœ</h4>
                        <p><strong>ä¿å­˜æµ‹è¯•ï¼š</strong>${success ? 'é€šè¿‡' : 'å¤±è´¥'}</p>
                        <p><strong>æ•°æ®å®Œæ•´æ€§ï¼š</strong>${success ? 'æ­£å¸¸' : 'å¼‚å¸¸'}</p>
                        <p><strong>å»ºè®®ï¼š</strong>${success ? 'é…ç½®ç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼Œå¯ä»¥è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•' : 'å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®'}</p>
                    </div>
                `;
            }, 1000);
        }

        function checkAllTests() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="test"]');
            const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            
            const summary = document.getElementById('test-summary');
            let statusClass = 'warning';
            let statusText = 'è¿›è¡Œä¸­';
            
            if (percentage === 100) {
                statusClass = 'success';
                statusText = 'å®Œæˆ';
            } else if (percentage >= 80) {
                statusClass = 'success';
                statusText = 'åŸºæœ¬å®Œæˆ';
            } else if (percentage >= 50) {
                statusClass = 'warning';
                statusText = 'éƒ¨åˆ†å®Œæˆ';
            } else {
                statusClass = 'error';
                statusText = 'éœ€è¦æ›´å¤šæµ‹è¯•';
            }
            
            summary.innerHTML = `
                <div class="result ${statusClass}">
                    <h4>ğŸ“Š æµ‹è¯•å®Œæˆæƒ…å†µ</h4>
                    <p><strong>å®Œæˆåº¦ï¼š</strong>${checked}/${total} (${percentage}%)</p>
                    <p><strong>çŠ¶æ€ï¼š</strong>${statusText}</p>
                    ${percentage === 100 ? '<p><strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é…ç½®æŒä¹…åŒ–åŠŸèƒ½å·¥ä½œæ­£å¸¸ã€‚</strong></p>' : ''}
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥localStorage
        document.addEventListener('DOMContentLoaded', function() {
            checkLocalStorage();
        });
    </script>
</body>
</html>